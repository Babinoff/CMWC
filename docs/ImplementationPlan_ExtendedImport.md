# План расширения поддержки импорта коллизий (Extended Import Support)

## 1. Анализ текущего состояния
Текущая реализация импорта (`detectCategories` в `App.tsx`) опирается исключительно на имя файла и ограниченный набор ключевых слов. Это приводит к потере данных для специфических дисциплин и категорий, которые активно используются в реальных отчетах Navisworks.

## 2. Выявленные проблемы и пробелы
На основе анализа файлов из `example/collision_reports` выявлены следующие неподдерживаемые категории:

| Категория | Код | Проблема текущей реализации | Примеры файлов |
|-----------|-----|-----------------------------|----------------|
| **АИ (Интерьеры)** | `AI` | Полностью отсутствует. | `09_АИ + АПТ.xml`, `20_АИ - АР...` |
| **СС (Слаботочка)** | `SS` | Мапится в `EOM` (Электрика). Требует разделения. | `09_АИ + СС.xml` |
| **Фасад (АР)** | `AR_FACADE` | Не распознается (нет ключевых слов). | `11.13_АР (Фасад)...` |
| **ИТП (ОВ)** | `OV_ITP` | Не распознается как часть ОВ. | `16_КР + ИТП...` |
| **Кладка (АР)** | `AR_WALLS` | Не распознается слово "Кладка". | `11.12_АР (Кладка)...` |
| **Зоны проверки** | `AR_CHECK` | Не распознаются проверки габаритов. | `13_ЭОМ - АР (Проверка...)` |

## 3. Техническое решение: Smart Parsing (Layered Approach)

Для максимальной точности будем использовать трехуровневую стратегию определения категорий.

### Уровень 1: `<locator>` (Путь набора поисковых наборов)
Это самый надежный источник, так как он указывает на структуру, созданную BIM-координатором.
*   *Где:* Теги `<clashtest> -> <left/right> -> <clashselection> -> <locator>`
*   *Пример:* `lcop_selection_set_tree/ВИС/АПТ`

### Уровень 2: `<pathlink>` (Иерархия элемента)
Если `<locator>` не дает однозначного ответа (или слишком общий), анализируем свойства конкретного элемента коллизии.
*   *Где:* Теги `<clashresults> -> <clashresult> -> <clashobjects> -> <clashobject> -> <pathlink>`
*   *Пример 1 (Кладка/Стены):*
    ```xml
    <pathlink>
      <node>Файл</node>
      <node>Файл</node>
      <node>W-1470_AR_R21.nwc</node>
      <node>Этаж 01</node>
      <node>Стены</node>
      <node>Базовая стена</node>
      <node>ADSK_Внутренняя_Кирпич_250</node>
      <node>Базовая стена</node>
      <node>Кладка_Кирпич_Рядовой_120мм</node>
    </pathlink>
    ```
    Здесь ключевые слова "Стены", "Кирпич" и "Кладка" позволяют точно определить `AR_WALLS`.

*   *Пример 2 (SML Трубы):*
    ```xml
    <pathlink>
      <node>Файл</node>
      <node>Файл</node>
      <node>W-1470_VK_VO_R21.nwc</node>
      <node>Трубы</node>
      <node>Типы трубопроводов</node>
      <node>ADSK_Чугун_Безраструбный SML_DIN EN 877</node>
      <node>Типы трубопроводов</node>
      <node>SML</node>
    </pathlink>
    ```
    Здесь "Трубы", "SML" и "Чугун" подтверждают категорию `VK_K` (Канализация).

### Уровень 3: Имя теста/файла (Fallback)
Используется как последний аргумент, если XML-структура не дала результатов.

## 4. План реализации

### Этап 1: Расширение Модели Данных
Добавить новые константы и категории в `App.tsx`:
*   **AI (Интерьеры)**: `AI_CEILING` (Потолки), `AI_FINISH` (Отделка), `AI_FLOOR` (Полы).
*   **SS (Слаботочка)**: `SS_NET` (Сети), `SS_FIRE` (Пожарная сигнализация), `SS_SEC` (Безопасность).
*   **AR (Архитектура)**: Добавить `AR_FACADE`, `AR_ROOF`.
*   **OV (Овик)**: Добавить `OV_ITP`.

### Этап 2: Реализация Smart Parsing
1.  Создать функцию `extractCategoriesFromPath(path: string): string | null`.
    *   Анализирует строки вида `lcop_selection_set_tree/ВИС/АПТ` и массивы узлов из `<pathlink>`.
2.  Обновить `parseCollisionXML`:
    *   Сначала извлекать `<locator>` из `clashtest`.
    *   Если не удалось определить категорию -> сканировать первые 5-10 `<clashresult>` и анализировать их `<pathlink>`.
    *   Если и это не помогло -> фолбэк на имя файла.

### Этап 3: Обновление Матрицы
*   Добавить поддержку рендеринга новых категорий (AI, SS) в матрицу.
*   Убедиться, что они корректно группируются.

### Этап 4: Верификация
*   Прогнать отчеты со сложными случаями (Кладка, Трубы SML, Интерьеры) и убедиться в правильности классификации.
